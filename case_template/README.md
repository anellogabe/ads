# ADS Case Template

## Overview

This template provides a standardized workflow for wage & hour compliance analysis cases. It connects to the ADS shared function library (via OneDrive) and provides clean, reproducible case analysis.

> **⚠️ IMPORTANT WORKFLOW RULE:**
> **ALWAYS run `clean_data.R` first!**
> This script sets up the ADS environment that all other scripts depend on.
> No other script will work without it.

## Prerequisites

### 1. OneDrive Access
- You must have access to the **ADS_Shared** folder on OneDrive
- Check that this folder is synced to your computer:
  ```
  C:/Users/[YOUR_USERNAME]/OneDrive - anellodatasolutions.com/Documents/0. ADS/ADS_Shared
  ```

### 2. Required R Packages
Install these packages if you haven't already:
```r
install.packages(c(
  "data.table", "dplyr", "tidyr", "lubridate",
  "readr", "readxl", "openxlsx", "stringr", "purrr",
  "zoo", "pagedown"
))
```

## Setup for a New Case

### Step 1: Copy This Template

1. Copy the entire `case_template` folder
2. Rename it to your case name (e.g., `Case_001_ClientName`)
3. Place it in your Cases folder:
   ```
   C:/Users/[YOUR_USERNAME]/Cases/Case_001_ClientName/
   ```

### Step 2: Update clean_data.R

Open `scripts/clean_data.R` and update **two critical lines**:

**Line ~36:** Update your OneDrive path
```r
ADS_SHARED <- Sys.getenv("ADS_SHARED",
  unset = "C:/Users/[YOUR_USERNAME]/OneDrive - anellodatasolutions.com/Documents/0. ADS/ADS_Shared")
```

**Line ~61:** Set your case directory
```r
set_case_dir("C:/Users/[YOUR_USERNAME]/Cases/Case_001_ClientName")
```

### Step 3: Add Your Data Files

Place raw data files in:
```
data/raw/
```

Then update the file paths in `clean_data.R` (around line 80):
```r
time1 <- read_excel("data/raw/time_data.xlsx")
pay1  <- read_excel("data/raw/pay_data.xlsx")
class1 <- read_excel("data/raw/class_list.xlsx")
```

## Workflow

### ⚠️ CRITICAL: ALWAYS Run clean_data.R First

**clean_data.R is the single entry point for every case.** It sets up the entire environment:
- Sources ADS functions from shared OneDrive
- Initializes case directory paths
- Makes functions available to all other scripts

All other scripts (analysis.R, app.R) depend on this setup.

### Standard Workflow (Run in Order)

1. **clean_data.R** - MUST run this first, every time
   - Sources ADS functions from OneDrive ADS_Shared folder
   - Sets up case directory structure (data/raw, data/processed, output)
   - Loads and cleans raw data
   - Saves processed data to `data/processed/`
   - **Makes environment ready for all other scripts**

2. **analysis.R** - Run after clean_data.R
   - Verifies clean_data.R was run (checks for paths and functions)
   - Loads processed data from `data/processed/`
   - Runs metrics calculations
   - Generates output files
   - Exports to `output/` folder

3. **app.R** (Optional) - Launch dashboard
   - Can run after clean_data.R to use existing environment
   - Or run standalone (will source ADS_Shared itself)
   - Displays interactive dashboard for data exploration

### Optional: Generate PDF Reports

After running analysis.R, you can generate PDF reports:

```r
# Load PDF generator from ADS_Shared
ADS_SHARED <- Sys.getenv("ADS_SHARED",
  unset = "C:/Users/[YOUR_USERNAME]/OneDrive - anellodatasolutions.com/Documents/0. ADS/ADS_Shared")

source(file.path(ADS_SHARED, "scripts", "generate_pdf.R"))

# Generate full report
generate_full_report()

# Or generate specific sections:
generate_class_report()      # Time + Pay + Class (no PAGA)
generate_paga_report()       # Time + Pay + PAGA (no Class)
generate_damages_report()    # Just Class + PAGA
generate_time_report()       # Just time analysis
```

## Directory Structure

```
Case_001_ClientName/
├── scripts/
│   ├── clean_data.R          # Run FIRST
│   ├── analysis.R            # Run SECOND
│   └── metrics_spec.csv      # Metrics definitions
├── data/
│   ├── raw/                  # Your raw data files (Excel, CSV)
│   └── processed/            # Cleaned data (generated by clean_data.R)
├── output/                   # Results (CSV, RDS, PDF files)
└── README.md                 # This file
```

## Troubleshooting

### "Cannot find ADS_Shared folder"

**Problem:** Script can't locate the ADS_Shared folder on OneDrive.

**Solutions:**
1. Check that OneDrive is syncing (right-click OneDrive icon in taskbar)
2. Verify the path matches your OneDrive location
3. Update line 36 in `clean_data.R` with the correct path
4. Alternatively, set an environment variable:
   ```cmd
   setx ADS_SHARED "C:\Users\[YOUR_USERNAME]\OneDrive - anellodatasolutions.com\Documents\0. ADS\ADS_Shared"
   ```

### "Environment not initialized" error in analysis.R

**Problem:** You tried to run analysis.R without running clean_data.R first.

**Solution:** **You MUST run `clean_data.R` before any other script.** The clean_data script:
- Sources ADS functions from OneDrive
- Sets up case paths
- Creates the environment that all other scripts depend on

**This is not optional** - clean_data.R is the required first step for every case.

### "Missing processed data" error

**Problem:** clean_data.R didn't save processed data files.

**Solution:**
1. Check that clean_data.R completed successfully
2. Look for error messages in the console
3. Verify `data/processed/` folder exists
4. Check that time_processed.rds, pay_processed.rds, class_processed.rds were created

### Functions not found

**Problem:** Functions like `set_case_dir()` or `init_case_paths()` are not found.

**Solution:**
1. Make sure clean_data.R successfully sourced functions.R
2. Look for error messages when sourcing ADS_Shared/scripts/functions.R
3. Check OneDrive sync status

## Getting Help

- For ADS functions or workflow issues, contact Gabriel Anello
- For R programming questions, see [R Documentation](https://www.r-project.org/help.html)
- For data.table help, see [data.table vignettes](https://cran.r-project.org/web/packages/data.table/vignettes/)

## Important Notes

⚠️ **Always run clean_data.R first** - It sets up everything analysis.R needs

⚠️ **Don't edit files in ADS_Shared** - These are read-only shared functions. Copy the template to your own folder to work with it.

⚠️ **Save your work** - All results go in the `output/` folder. Back up important files.

⚠️ **Proprietary Code** - The ADS functions are proprietary. Do not copy or distribute outside authorized use.
